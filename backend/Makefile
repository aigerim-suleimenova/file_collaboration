# Makefile for FastAPI app with virtual environment management

.PHONY: help venv install install-dev run clean test lint format check

# Default target
help:
	@echo "Available commands:"
	@echo "  make venv        - Create virtual environment"
	@echo "  make install     - Install production dependencies"
	@echo "  make install-dev - Install development dependencies"
	@echo "  make run         - Run the FastAPI app"
	@echo "  make test        - Run tests"
	@echo "  make lint        - Run linting checks"
	@echo "  make format      - Format code with black and isort"
	@echo "  make check       - Run all quality checks"
	@echo "  make clean       - Remove virtual environment"
	@echo "  make help        - Show this help"

# Create virtual environment
venv:
	@echo "ğŸ”§ Creating virtual environment..."
	python3 -m venv venv
	@echo "âœ… Virtual environment created!"

# Install production dependencies
install: venv
	@echo "ğŸ“¦ Installing production dependencies..."
	venv/bin/pip install -r requirements.txt
	@echo "âœ… Production dependencies installed!"

# Install development dependencies
install-dev: venv
	@echo "ğŸ“¦ Installing development dependencies..."
	venv/bin/pip install -r requirements-dev.txt
	@echo "âœ… Development dependencies installed!"

# Run the app
run: install
	@echo "ğŸš€ Starting FastAPI app..."
	@echo "ğŸŒ App will be available at: http://localhost:8000"
	@echo "ğŸ“– API docs at: http://localhost:8000/docs"
	@echo "ğŸ”„ Press Ctrl+C to stop the server"
	@echo "----------------------------------------"
	venv/bin/uvicorn app.main:app --reload --host 0.0.0.0 --port 8000

# Run tests
test: install-dev
	@echo "ğŸ§ª Running tests..."
	venv/bin/pytest

# Run linting
lint: install-dev
	@echo "ğŸ” Running linting checks..."
	venv/bin/flake8 app/
	venv/bin/mypy app/

# Format code
format: install-dev
	@echo "ğŸ¨ Formatting code..."
	venv/bin/black app/
	venv/bin/isort app/

# Auto-fix style only
fix: install-dev
	@echo "ğŸ›  Auto-fixing code style..."
	venv/bin/black app/
	venv/bin/isort app/
# Run all quality checks
check: format lint test
	@echo "âœ… All quality checks passed!"

# Clean up
clean:
	@echo "ğŸ§¹ Removing virtual environment..."
	rm -rf venv
	@echo "âœ… Virtual environment removed!"

# Quick start (create venv, install deps, and run)
start: run
